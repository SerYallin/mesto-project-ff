(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}e.r(t),e.d(t,{addCard:()=>b,getInitialCards:()=>_,getUserInfo:()=>S,removeCard:()=>h,removeLike:()=>k,setAvatar:()=>L,setLike:()=>g,setUserInfo:()=>C});var n={source:document.querySelector("#card-template").content,selectors:{image:".card__image",title:".card__title",deleteButton:".card__delete-button",deletePopup:".card__delete-button",likeButton:".card__like-button",likeNumber:".card__like-num"},classes:{card:"card",likeActive:"card__like-button_is-active"}},o=function(e,t,o,i,c){if(n.source&&"object"===r(e)){e=Object.assign({name:"",link:""},e);var s=n.source.cloneNode(!0),l=s.querySelector(n.selectors.image),u=s.querySelector(n.selectors.title),d=s.querySelector(n.selectors.deleteButton),p=s.querySelector(n.selectors.likeButton);return s.querySelector("."+n.classes.card).dataset.id=e._id,l&&(l.alt=e.name,l.src=e.link,i&&l.addEventListener("click",i)),u&&(u.textContent=e.name),c!==e.owner._id?d.remove():t&&d.addEventListener("click",(function(r){t(r.target,e._id)})),p&&o&&p.addEventListener("click",(function(t){o(t.target,e._id,c)})),a(e,p,c),s}},a=function(e,t,r){var o=t.closest("."+n.classes.card).querySelector(n.selectors.likeNumber);e.likes.some((function(e){return e._id===r}))?t.classList.add(n.classes.likeActive):t.classList.remove(n.classes.likeActive),o.textContent=e.likes.length},i="popup_is-opened",c=function(e){e.classList.add(i),document.addEventListener("keyup",l)},s=function(e){e.classList.remove(i),document.removeEventListener("keyup",l)},l=function(e){var t=document.querySelector("."+i);t&&"Escape"===e.key&&s(t)},u=function(e){var t=e.target;(function(e){return e.target.classList.contains("popup")})(e)&&function(e){return e.classList.contains(i)}(t)&&s(t)},d={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"button_disabled",inputErrorClass:"input_type_error",errorClass:"error_visible",errorBlockClass:"popup__error"},p=function(e,t){t.validity.valid?function(e,t){var r=t.nextElementSibling;r.classList.contains(d.errorBlockClass)&&(r.textContent="",r.classList.remove(d.errorClass)),t.classList.remove(d.inputErrorClass)}(0,t):function(e,t){var r=t.nextElementSibling;r.classList.contains(d.errorBlockClass)&&(t.validity.patternMismatch&&t.dataset.messageerror?r.textContent=t.dataset.messageerror:r.textContent=t.validationMessage,r.classList.add(d.errorClass)),t.classList.add(d.inputErrorClass)}(0,t)},f=function(e,t,r){(void 0!==r?!r:e.some((function(e){return!e.validity.valid})))?(t.classList.add(d.inactiveButtonClass),t.disabled=!0):(t.classList.remove(d.inactiveButtonClass),t.disabled=!1)},m=function(e){var t=Array.from(e.querySelectorAll(d.inputSelector)),r=e.querySelector(d.submitButtonSelector);t.forEach((function(e){var t=e.nextElementSibling;t.classList.contains(d.errorBlockClass)&&t.classList.remove(d.errorClass),e.classList.remove(d.inputErrorClass)})),f(t,r,!1)},v={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",apiCards:"/cards",apiUser:"/users/me",apiAvatar:"/users/me/avatar",headers:{authorization:"9a968fd7-1674-4659-aab2-f08b905c4304","Content-Type":"application/json"}},y=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},_=function(){return fetch(v.baseUrl+v.apiCards,{headers:v.headers}).then(y)},b=function(e,t){return fetch(v.baseUrl+v.apiCards,{method:"POST",headers:v.headers,body:JSON.stringify({name:e,link:t})}).then(y)},h=function(e){return fetch(v.baseUrl+v.apiCards+"/"+e,{method:"DELETE",headers:v.headers}).then(y)},S=function(){return fetch(v.baseUrl+v.apiUser,{headers:v.headers}).then(y)},C=function(e,t){return fetch(v.baseUrl+v.apiUser,{method:"PATCH",headers:v.headers,body:JSON.stringify({name:e,about:t})}).then(y)},g=function(e){return fetch(v.baseUrl+v.apiCards+"/"+e+"/likes",{method:"PUT",headers:v.headers}).then(y)},k=function(e){return fetch(v.baseUrl+v.apiCards+"/"+e+"/likes",{method:"DELETE",headers:v.headers}).then(y)},L=function(e){return fetch(v.baseUrl+v.apiAvatar,{method:"PATCH",headers:v.headers,body:JSON.stringify({avatar:e})}).then(y)},E="Сохранить",q="Сохранение...";function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var A,B=document.querySelector(".places").querySelector(".places__list"),U=document.querySelector(".profile__add-button"),j=document.querySelector(".popup_type_new-card"),O=j.querySelector(".popup__form"),P=document.querySelector(".profile__edit-button"),T=document.querySelector(".popup_type_edit"),w=T.querySelector(".popup__form"),I=document.querySelector(".popup_type_edit-avatar"),D=document.querySelector(".profile__edit-avatar"),N=I.querySelector(".popup__form"),M=document.querySelector(".profile__title"),J=document.querySelector(".profile__description"),H=document.querySelector(".profile__image"),z=document.querySelector(".popup_type_image"),$=document.querySelectorAll(".popup"),F=document.querySelector(".popup_type_remove-card"),G=F.querySelector(".popup__form"),K={card:null,id:null},Q=function(e){var t=e.target;if(t.classList.contains("card__image")){c(z);var r=z.querySelector(".popup__image"),n=z.querySelector(".popup__caption");r.src=t.src,r.alt=t.alt,n.textContent=t.alt}},R=function(e,t){K.card=e,K.id=t,c(F)},V=function(e,r,n){var o=e.classList.contains("card__like-button_is-active")?"removeLike":"setLike";t[o](r).then((function(t){a(t,e,n)})).catch((function(e){console.log(e)}))};G.addEventListener("submit",(function(e){e.preventDefault(),h(K.id).then((function(e){var t;(t=K.card).classList.contains(n.classes.card)||(t=t.closest("."+n.classes.card)),t&&t.remove(),s(F)})).catch((function(e){console.log(e)}))})),Promise.all([S(),_()]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=n[0],i=n[1];M.textContent=a.name,J.textContent=a.about,H.style.backgroundImage="url(".concat(a.avatar,")"),i.forEach((function(e){B.append(o(e,R,V,Q,a._id))}))})),$.forEach((function(e){var t=e.querySelector(".popup__close");t&&t.addEventListener("click",(function(t){s(e)})),e.addEventListener("click",u)})),P.addEventListener("click",(function(e){c(T);var t=new Event("input");w.name.value=M.textContent,w.name.dispatchEvent(t),w.description.value=J.textContent,w.description.dispatchEvent(t),m(w)})),w.addEventListener("submit",(function(e){var t=w.querySelector(".popup__button");e.preventDefault(),t.textContent=q,t.disabled=!0,C(w.name.value,w.description.value).then((function(e){M.textContent=e.name,J.textContent=e.about,t.textContent=E,t.disabled=!1,s(T)})).catch((function(e){console.log(e)}))})),U.addEventListener("click",(function(e){O.reset(),m(O),c(j)})),O.addEventListener("submit",(function(e){var t=O.querySelector(".popup__button");t.textContent=q,t.disabled=!0,e.preventDefault(),b(O["place-name"].value,O.link.value).then((function(e){B.prepend(o(e,R,V,Q,e.owner._id)),t.textContent=E,t.disabled=!1,s(j)})).catch((function(e){console.log(e)}))})),D.addEventListener("click",(function(e){N.reset(),m(N),c(I)})),N.addEventListener("submit",(function(e){var t=N.querySelector(".popup__button");t.textContent=q,t.disabled=!0,e.preventDefault(),L(N.link.value).then((function(e){H.style.backgroundImage="url(".concat(e.avatar,")"),t.textContent=E,t.disabled=!1,s(I)})).catch((function(e){console.log(e)}))})),A={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Object.keys(A).map((function(e){d[e]=A[e]})),Array.from(document.querySelectorAll(d.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(d.inputSelector)),r=e.querySelector(d.submitButtonSelector);f(t,r),t.forEach((function(e){e.addEventListener("input",(function(){p(0,e),f(t,r)})),p(0,e)}))}(e)}))})();